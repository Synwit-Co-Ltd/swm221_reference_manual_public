**1.1加强型定时器（TIMER）**
----------------------------

**1.1.1概述**
~~~~~~~~~~~~~

SWM221系列所有型号TIMER操作均相同，
不同型号具备TIMER数量可能不同。使用前需使能TIMER模块时钟。

每个TIMER模块均具备定时器功能（使用片内时钟作为计数基准）和计数器功能、输出比较及输入捕获功能。

TIMER0支持Hall功能及连续脉宽捕捉功能。

**1.1.2特性**
~~~~~~~~~~~~~

-  3路32位通用定时器

   -  24位计数器

   -  8位预分频

-  可单独配置计时触发条件为内部时钟或者外部输入

-  支持脉冲捕获及宽度测量，检测脉冲极性可配

-  支持脉冲发送功能，可作为PWM使用

-  TIMER0支持HALL功能，可采集霍尔传感器

-  TIMER0~1输出可作为外部触发事件信号

-  定时器溢出脉冲输出，可用于触发ADC

**1.1.3模块结构框图**
~~~~~~~~~~~~~~~~~~~~~

|image1|

图 1‑1 TIMER 模块结构框图

**1.1.4功能描述**
~~~~~~~~~~~~~~~~~

**定时器**
^^^^^^^^^^

使用TIMERx作为定时器时，为递减计数。流程如下：

-  将控制寄存器（CRx）中MODEx位配置为定时器，CLKSRCx位配置计数源选择，配置为使用系统时钟作为计数源。

-  通过装载值寄存器（LOADx）设置计数起始值。

-  使能寄存器（EN）对应位使能为1。

-  对应TIMERx开始递减计数，计数到0时，产生中断，同时重新装载计数值，进行下一周期计数。

在计数过程中，可通过对当前值寄存器（VALUEx）进行读取，获取当前计数值。

定时器计数过程中改变装载值寄存器（LOADx）值，将在下个计数周期（计数到0重新装载）生效，不会改变本周期计数值。

定时器计数过程中，可以通过HALT寄存器控制位置1暂停指定通道计数，置0后继续计数。

如图 1‑2所示。

|image2|

图 1‑2定时器工作示意图

**计数器**
^^^^^^^^^^

使用TIMERx作为计数器时，为递减计数。流程如下：

-  将控制寄存器（CRx）中MODEx位配置为计数器，CLKSRCx位计数源选择配置为外部的触发信号的上升沿。此时，对应TIMER将以配置为CNT引脚外部输入的上升沿作为计数目标。

-  针对外部信号输入引脚进行如下操作：

   -  配置PORTCON模块中INEN寄存器使能引脚输入功能。

   -  通过PORTX_FUNC寄存器将引脚切换为指定数字功能。

-  通过装载值寄存器（LOADx）设置计数目标值。

-  使能寄存器（EN）对应位使能为1，对应TIMERx开始递减计数，计数到0时，产生中断，同时重新装载计数值，进行下一周期计数。

在计数过程中，可通过对当前值寄存器（VALUEx）进行读取，获取当前计数值。

定时器计数过程中改变装载值寄存器（LOADx）值，将在下个计数周期（计数到0重新装载）生效，不会改变本周期计数值。

计数器使用过程中，可以通过HALT寄存器控制位置1暂停指定通道计数，置0后继续计数。

示意图如图 1‑3所示。

|image3|

图 1‑3计数器工作示意图

**级联**
^^^^^^^^

当TIMER无法满足计数宽度或时间长度时，可以通过级联方式，使计数周期为TIMER位宽相乘的关系。最高支持两级级联。

使用方式如下：

-  TIMERn根据需要设置为定时器或计数器模式

-  TIMERn+1设置为级联模式（CLKSRCx位配置为使用上一路计数器的进位标志）

-  LOADn = 目标计数值A

-  LOADn+1 = 目标计数值B，总计数周期为A*B

-  使能TIMERn+1中断

-  使能TIMERn+1

-  使能TIMERn

-  TIMERn+1中断产生，在中断程序中使能TIMERn中断

-  TIMERn中断产生，计数周期完成

示意图如图 1‑4所示：

|image4|

图 1‑4级联模式工作示意图

**脉冲发送**
^^^^^^^^^^^^

所有TIMER模块均支持脉冲发送功能，可发送指定脉宽的方波。该计数器为向下计数。使用方式如下：

-  针对外部信号输入引脚进行如下操作

   -  配置PORTCON模块中使能引脚输出功能

   -  通过PORTX_FUNC寄存器将引脚切换为TIMER对应数字功能

-  TIMER初始化

   -  指定要被设置的定时器

   -  设置TIMER的工作模式为OC(输出比较)模式

   -  设置定时周期

-  输出比较功能初始化

   -  指定要被设置的定时器

   -  设置当计数器的值递减到MATCH时引脚输出电平翻转

   -  设置初始输出电平

-  启动定时器

-  每次周期结束时，会更新翻转电平配置

示意图如图 1‑5所示：

|image5|

图 1‑5脉冲发送示意图

**脉冲捕捉**
^^^^^^^^^^^^

所有TIMER模块均支持用于捕捉外部脉宽，可记录外部单个脉冲宽度。

使用方式如下：

-  针对外部信号输入引脚进行如下操作

   -  配置PORTCON模块中INEN寄存器使能引脚输入功能

   -  通过PORTX_FUNC寄存器将引脚切换为TIMER对应数字功能

-  设置中断使能寄存器（IEx），使能中断

-  使能寄存器（EN）对应位使能，启动捕捉功能

-  当指定引脚出现变化沿时，开始记录宽度，再次出现沿时，将对应种类的脉宽长度记录于ICLOWx或ICHIGHx寄存器，并产生中断。

-  进入中断，读取脉冲长度寄存器，获取指定种类的脉冲宽度

-  如果不操作EN位，则持续记录电平宽度，直至EN位关闭。

捕捉高电平示意图如图 1‑6所示。

|image6|

图 1‑6单次高电平捕捉示意图

低电平示意图如图 1‑7所示。

|image7|

图 1‑7单次低电平捕捉示意图

**霍尔接口**
^^^^^^^^^^^^

TIMER0模块提供了HALL接口功能，能够自动记录脉冲变化间隔，并产生中断。

使用方式如下：

-  HALL功能为指定引脚，且不同封装可能有所差异，具体引脚详见管脚排布：

   -  配置PORTCON模块中INEN寄存器使能引脚输入功能

   -  通过PORTX_FUNC寄存器将引脚切换为HALL功能

-  配置HALLSR寄存器，设置对应HALL输入信号的原状态

-  配置TIMER0装载值寄存器（LOADx）

-  使能HALL模式控制寄存器中输入HALL信号触发使能位（HALLEN）

-  清除输入HALL信号触发中断的状态（HALLIF）

-  使能HALL中断（HALLIE）

-  TIMER0使能（EN）

-  当外部HALLX引脚产生指定电平变化时，将（计数器加载值-计数器当前值）的结果保存到寄存器HALLDR中，计数器复位到加载值重新计数，并产生TIMER中断。同时HALLIF寄存器IFx将产生对应标示位，标识对应引脚产生电平变化。

记录示意图如图 1‑8所示。

|image8|

图 1‑8 HALL记录值

HALL0、HALL1、HALL2是HALL功能的三个输入引脚，任意一个HALL引脚上出现跳变沿时，将（计数器加载值-计数器当前值）的结果保存到寄存器HALLDR中，并且计数器复位到加载值重新计数。

HALL0~2信号输入同时支持连接至CMP0~2，可通过ACMPCR2寄存器HALLx位配置,可选择为CMPxOUT引脚或者HALL
IO引脚。

|image9|

图 1‑9 HALL对应关系图

**中断配置与清除**
^^^^^^^^^^^^^^^^^^

每路TIMER均具备独立中断，通过中断使能寄存器IE进行各TIMER中断使能。通过中断状态寄存器IF进行中断查询及清除。

TIMER中断

可通过配置中断使能寄存器IEx相应位使能中断。当检测到中断触发条件时，中断标志寄存器IFx相应位中置1。如需清除此标志，需在相应标志位中写1清零（R/W1C），否则中断在开启状态下会一直进入。

HALL中断

可通过配置HALL模式控制寄存器对应位设置输入HALLx信号触发中断的条件：上升沿、下降沿、上升沿和下降沿。可通过配置HALL中断使能寄存器HALLIE相应位使能中断。当检测到中断触发条件时，HALL中断标志寄存器HALLIF相应位中置1。如需清除此标志，需在相应标志位中写1清零（R/W1C），否则中断在开启状态下会一直进入。

**1.1.5寄存器映射**
~~~~~~~~~~~~~~~~~~~

.. list-table::
   :widths: 13 8 6 12 33

   - 

      - **名称**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **TIMER0 BASE：0x40043800**

         **TIMER1 BASE：0x40043840**

         **TIMER2 BASE：0x40043880**
      - 
      - 
      - 
      - 
   - 

      - **LOAD**
      - 0x00
      - R/W
      - 0x00
      - 计数器CNTUx计数初始值
   - 

      - **VALUE**
      - 0x04
      - RO
      - 0x01
      - 计数器当前值。
   - 

      - **CR**
      - 0x08
      - R/W
      - 0x00
      - 定时器控制寄存器
   - 

      - **IE**
      - 0x10
      - R/W
      - 0x00
      - 定时器中断使能
   - 

      - **IF**
      - 0x14
      - R/W1C
      - 0x00
      - 定时器中断状态。写1清零
   - 

      - **HALT**
      - 0x18
      - R/W
      - 0x00
      - 定时器暂停控制

         1：暂停当前定时器的计数

         0：当前定时器正常减计数
   - 

      - **OCCR**
      - 0x1C
      - R/W
      - 0x00
      - 输出PWM的控制信号。当PONO>x时才有效，否则该寄存器为只读，且为0
   - 

      - **OCMAT**
      - 0x20
      - R/W
      - 0x00
      - PWM输出高电平宽度。当POTVAL0==0时，占空比为0；当POTVAL0>LDVALU时，占空比为100%
   - 

      - **ICLOW**
      - 0x28
      - RO
      - 0x00
      - 输入脉冲的低电平长度。当PINO>x时才有效，否则为常0。当输入脉冲的上升沿来到时，自动更新。
   - 

      - **ICHIGH**
      - 0x2C
      - RO
      - 0x00
      - 输入脉冲的高电平长度。当PINO>x时才有效，否则为常0。当输入脉冲的下降沿来到时，自动更新。
   - 

      - **PREDIV**
      - 0x30
      - R/W
      - 0x00
      - 计数器CNTDx计数初始值

.. list-table::
   :widths: 13 8 6 12 33

   - 

      - **名称**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALLIE**
      - 0x400
      - R/W
      - 0x00
      - HALL中断使能。仅当定义HALL时有效，否则为只读，且为常0。

         bit0控制第1组hall，bit1控制第2组hall

         1：HALL中断使能

         0：HALL中断不使能
   - 

      - **HALLIF**
      - 0x408
      - R,W1C
      - 0x00
      - HALL中断状态。写1清零。仅当定义HALL时有效，否则为只读，且为常0

         bit[2:0]对应第1组hall三个输入，bit[5:3]对应第2组hall三个输入
   - 

      - **HALLEN**
      - 0x40C
      - R/W
      - 0x00
      - 输入HALL信号触发使能

         1’b0：不触发

         1’b1：触发
   - 

      - **HALLDR**
      - 0x410
      - RO
      - 0x00
      - HALL
         组1触发时，通道0计数器的计数值。仅当定义HALL时有效，否则为只读，且为常0
   - 

      - **HALLSR**
      - 0x41C
      - RO
      - 0x00
      - 外部HALL输入信号的状态。

         bit[2:0]对应第1组hall三个输入，

         bit[5:3]对应第2组hall三个输入
   - 

      - ICSR
      - 0x420
      - R/W
      - 0x00
      - 外部捕获输入信号的状态。

         Bit0对应通道0，bit1对应通道1，依此类推，反映作为捕获输入通道的实时输入状态。
   - 

      - EN
      - 0x440
      - R/W
      - 0x00
      - 定时器使能。Bit0对应通道0，bit1对应通道1，依次类推。在定时器模式和PWM模式下，向这一位写1会马上启动计数器，开始计数。在输入脉冲测量模式下，向这一位写1，该位并不会马上变1，而是等到输入脉冲的上升沿或者下降沿到来后才变1，计数器开始计数。

**1.1.6寄存器描述**
~~~~~~~~~~~~~~~~~~~

LOAD寄存器

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **LOAD**
      - 0x00
      - R/W
      - 0
      - Timer计数初始值

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - DATA
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - DATA
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - DATA
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - -
   - 

      - **23:0**
      - DATA
      - CNTUx的初始值

**VALUE**\ 寄存器

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **VALUE**
      - 0x04
      - RO
      - 0
      - Timer计数器当前值

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - CNT
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - CNT
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - CNT
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - -
   - 

      - **23:0**
      - CNT
      - 计数器的当前值

**控制寄存器CTRL**
^^^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **CTRL**
      - 0x08
      - R/W
      - 0
      - 定时器控制寄存器

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - EDGESEL
      - 
      - MODE
      - 
      - SRCSEL
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:6**
      - -
      - -
   - 

      - **5:4**
      - EDGESEL
      - 输入脉冲测量模式下，选择启动计数的沿。

         00：检测到上升沿或者下降沿后开始计数

         01：检测到上升沿开始计数

         10：检测到下降沿开始计数
   - 

      - **3:2**
      - MODE
      - 定时器工作模式。

         00：普通定时器模式

         01：输入脉冲测量模式（仅当PINO>x时才可以配置为这个值）

         10：输出PWM模式（仅当PONO>x时才可以配置为这个值）
   - 

      - **1:0**
      - SRCSEL
      - 定时器计数触发选择

         00：使用内部系统时钟上升沿

**IE寄存器**
^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **IE**
      - 0x10
      - R/W
      - 0x00
      - 定时器中断控制寄存器

.. list-table::
   :widths: 9 9 9 0 9 0 9 0 9 0 9 0 9

   - 

      - **31**
      - **30**
      - **29**
      - 
      - **28**
      - 
      - **27**
      - 
      - **26**
      - 
      - **25**
      - 
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - 
      - **20**
      - 
      - **19**
      - 
      - **18**
      - 
      - **17**
      - 
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - 
      - **12**
      - 
      - **11**
      - 
      - **10**
      - 
      - **9**
      - 
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - 
      - **4**
      - 
      - **3**
      - 
      - **2**
      - 
      - **1**
      - 
      - **0**
   - 

      - -
      - 
      - 
      - PIFINTMSK
      - 
      - PIRINTMSK
      - 
      - 
      - 
      - POT0INTMSK
      - 
      - TOINTMSK
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:5**
      - -
      - 
   - 

      - **4**
      - PIFINTMSK
      - 输入脉冲下降沿中断屏蔽（当PINO>x时，配置此位才生效）

         0：屏蔽

         1：不屏蔽
   - 

      - **3**
      - PIRINTMSK
      - 输入脉冲上升沿中断屏蔽（当PINO>x时，配置此位才生效）

         0：屏蔽

         1：不屏蔽
   - 

      - **2**
      - -
      - 
   - 

      - **1**
      - POT0INTMSK
      - 输出PWM翻转点0中断屏蔽（当PONO>x时，配置此位才生效）

         0：屏蔽

         1：不屏蔽
   - 

      - **0**
      - TOINTMSK
      - 计数器溢出中断屏蔽

         0：屏蔽

         1：不屏蔽

**IF寄存器**
^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **IF**
      - 0x14
      - R/W1C
      - 0
      - 中断状态寄存器

.. list-table::
   :widths: 9 9 9 0 9 0 9 0 9 0 9 0 9

   - 

      - **31**
      - **30**
      - **29**
      - 
      - **28**
      - 
      - **27**
      - 
      - **26**
      - 
      - **25**
      - 
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - 
      - **20**
      - 
      - **19**
      - 
      - **18**
      - 
      - **17**
      - 
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - 
      - **12**
      - 
      - **11**
      - 
      - **10**
      - 
      - **9**
      - 
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - 
      - **4**
      - 
      - **3**
      - 
      - **2**
      - 
      - **1**
      - 
      - **0**
   - 

      - -
      - 
      - 
      - PIFINTST
      - 
      - PIRINTST
      - 
      - 
      - 
      - POT0INTST
      - 
      - TOINTST
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:5**
      - -
      - 
   - 

      - **4**
      - PIFINTST
      - 输入脉冲下降沿中断状态（当PINO>x时，配置此位才生效）

         1：中断发生

         0：中断未发生
   - 

      - **3**
      - PIRINTST
      - 输入脉冲上升沿中断状态（当PINO>x时，配置此位才生效）

         1：中断发生

         0：中断未发生
   - 

      - **2**
      - -
      - 
   - 

      - **1**
      - POT0INTST
      - 输出PWM翻转点0中断状态（当PONO>x时，配置此位才生效）

         1：中断发生

         0：中断未发生
   - 

      - **0**
      - TOINTST
      - 计数器溢出中断状态

         1：中断发生

         0：中断未发生

**HALT寄存器**
^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALT**
      - 0x18
      - R/W
      - 0x0
      - 定时器暂停控制寄存器

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - Halt

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:1**
      - -
      - -
   - 

      - **0**
      - halt
      - 定时器暂停控制

         1：暂停当前定时器的计数

         0：当前定时器正常减计数

**OCCR寄存器**
^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **OCCR**
      - 0x1C
      - R/W
      - 0
      - 输出PWM的控制寄存器

.. list-table::
   :widths: 9 9 9 9 9 0 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - 
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - 
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - 
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - 
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - POMSK
      - 
      - POINITVAL
      - POMSKVAL

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:3**
      - -
      - -
   - 

      - **2**
      - POMSK
      - PWM输出屏蔽位。将PWM的输出屏蔽到POMSKVALx指定的值。当PONO>x时才有效。
   - 

      - **1**
      - POINITVAL
      - PWM输出的起始值。当PONO>x时才有效。
   - 

      - **0**
      - POMSKVAL
      - PWM输出屏蔽值。当PONO>x时才有效。

**OCMAT控制寄存器**
^^^^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **OCMAT**
      - 0x20
      - R/W
      - 0x0
      - PWM输出高电平控制寄存器

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - POTVAL
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - POTVAL
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - POTVAL
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - -
   - 

      - **23:0**
      - POTVAL
      - PWM输出高电平宽度。当POTVAL==0时，占空比为0；当POTVAL>CNTU时，占空比为100%。

**ICLOW寄存器**
^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **ICLOW**
      - 0x28
      - RO
      - 0x0
      - 输入脉冲的低电平长度

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - PLOW
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - PLOW
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - PLOW
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - -
   - 

      - **23:0**
      - PLOW
      - 输入脉冲的低电平长度。当PINO>x时才有效，否则为常0。当输入脉冲的上升沿来到时，自动更新。

**ICHIGH寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **ICHIGH**
      - 0x2C
      - RO
      - 0x0
      - 输入脉冲的高电平长度

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - PHIGH
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - PHIGH
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - PHIGH
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - -
   - 

      - **23:0**
      - PHIGH
      - 输入脉冲的高电平长度。当PINO>x时才有效，否则为常0。当输入脉冲的下降沿来到时，自动更新。

**PREDIV寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **PRIDIV**
      - 0x30
      - R/W
      - 0x0
      - 计数器 CNTDx计数初始值

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - LDVALD
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - -
   - 

      - **23:0**
      - LDVALD
      - 计数器 CNTDx计数初始值,也是定时器x计数低八位的初值

**HALLIE寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALLIE**
      - 0x400
      - R/W
      - 0x0
      - HALL中断使能

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - HALLIE
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:2**
      - -
      - RESERVED
   - 

      - **1:0**
      - HALLIE
      - HALL中断使能。仅当定义HALL时有效，否则为只读，且为常0。

         1：HALL中断使能

         0：HALL中断不使能

**HALLIF寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALLIF**
      - 0x408
      - R/W
      - 0x0
      - HALL中断状态

.. list-table::
   :widths: 9 9 9 9 9 0 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - 
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - 
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - 
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - 
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - HALLINTST2
      - 
      - HALLINTST1
      - HALLINTST0

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:6**
      - -
      - RESERVED
   - 

      - **2**
      - HALLINTST2
      - 输入HALL信号2触发中断的状态
   - 

      - **1**
      - HALLINTST1
      - 输入HALL信号1触发中断的状态
   - 

      - **0**
      - HALLINTST0
      - 输入HALL信号0触发中断的状态

**HALLEN寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALLEN**
      - 0x40C
      - R/W
      - 0x0
      - HALL功能开关

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - HALLMD
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:2**
      - -
      - RESERVED
   - 

      - **1:0**
      - HALLEN
      - 输入HALL信号触发使能

         1’b0：不触发

         1’b1：触发

**HALLDR寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALLDR**
      - 0x410
      - RO
      - 0x0
      - 通道0计数器的计数值

.. list-table::
   :widths: 9 9 9 9 9 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - **17**
      - **16**
   - 

      - HALLDR
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - **9**
      - **8**
   - 

      - HALLDR
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - **1**
      - **0**
   - 

      - HALLDR
      - 
      - 
      - 
      - 
      - 
      - 
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:24**
      - -
      - RESERVED
   - 

      - **23:0**
      - **HALLDR**
      - HALL组1触发时，通道0计数器的计数值。仅当定义HALL时有效，否则为只读，且为常0。

         由于本模块为减计数，通道0计数器作为HALL功能使用时，该计数值=（计数器加载值-触发HALL沿时计数器当前值）

**HALLSR寄存器**
^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **HALLSR**
      - 0x41C
      - RO
      - 0x0
      - 通道0计数器的计数值

.. list-table::
   :widths: 9 9 9 9 9 0 9 9 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - 
      - **26**
      - **25**
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - 
      - **18**
      - **17**
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - 
      - **10**
      - **9**
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - 
      - **2**
      - **1**
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - HALLSR2
      - 
      - HALLSR1
      - HALLSR0

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:3**
      - -
      - RESERVED
   - 

      - **2**
      - HALLSR2
      - 输入HALL信号2的状态
   - 

      - **1**
      - HALLSR1
      - 输入HALL信号1的状态
   - 

      - **0**
      - HALLSR0
      - 输入HALL信号0的状态

**ICSR寄存器**
^^^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **ICSR**
      - 0x420
      - RO
      - 0x0
      - 输入capture信号的状态

.. list-table::
   :widths: 9 9 9 9 9 9 0 9 0 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - 
      - **25**
      - 
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - 
      - **17**
      - 
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - 
      - **9**
      - 
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - 
      - **1**
      - 
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - IC_TIMER2
      - IC_TIMER1
      - 
      - IC_TIMER0
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - **31:3**
      - -
      - 
   - 

      - **2**
      - IC_TIMER2
      - Timer2输入捕获信号状态
   - 

      - **1**
      - IC_TIMER1
      - Timer1输入捕获信号状态
   - 

      - **0**
      - IC_TIMER0
      - Timer0输入捕获信号状态

**EN寄存器**
^^^^^^^^^^^^

.. list-table::
   :widths: 12 9 6 12 33

   - 

      - **寄存器**
      - **偏移**
      - **类型**
      - **复位值**
      - **描述**
   - 

      - **EN**
      - 0x440
      - R/W
      - 0x0
      - 定时器使能

.. list-table::
   :widths: 9 9 9 9 9 9 0 9 0 9

   - 

      - **31**
      - **30**
      - **29**
      - **28**
      - **27**
      - **26**
      - 
      - **25**
      - 
      - **24**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **23**
      - **22**
      - **21**
      - **20**
      - **19**
      - **18**
      - 
      - **17**
      - 
      - **16**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **15**
      - **14**
      - **13**
      - **12**
      - **11**
      - **10**
      - 
      - **9**
      - 
      - **8**
   - 

      - -
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
      - 
   - 

      - **7**
      - **6**
      - **5**
      - **4**
      - **3**
      - **2**
      - 
      - **1**
      - 
      - **0**
   - 

      - -
      - 
      - 
      - 
      - 
      - TIMER2_EN
      - TIMER1_EN
      - 
      - TIMER0_EN
      - 

.. list-table::
   :widths: 7 15 50

   - 

      - **位域**
      - **名称**
      - **描述**
   - 

      - 31: 3
      - -
      - RESERVED
   - 

      - 2
      - TIMER2_EN
      - 定时器timer2使能。
   - 

      - 1
      - TIMER1_EN
      - 定时器timer1使能。
   - 

      - 0
      - TIMER0_EN
      - 定时器timer0使能。

.. |image1| image:: media/image1.emf
.. |image2| image:: media/image2.emf
.. |image3| image:: media/image3.emf
.. |image4| image:: media/image4.emf
.. |image5| image:: media/image5.emf
.. |image6| image:: media/image6.emf
.. |image7| image:: media/image7.emf
.. |image8| image:: media/image8.emf
.. |image9| image:: media/image9.emf
